
<div class="container">
  <div class="Intro">
      <h1>User Management</h1>
  </div>

  <div class="headers">
    <div class="adduser">
      <button (click)="openCreateModal()">Add User</button>

      <ng-container *ngIf="!multiSelectMode && !isMobile">
        <button class="bulk-select-btn" (click)="enableMultiSelect()">Select All</button>
      </ng-container>

      <ng-container *ngIf="multiSelectMode">
        <button class="delete-selected-btn" (click)="deleteSelectedUsers()" [disabled]="selectedUsers.length === 0">
          Delete Selected ({{ selectedUsers.length }})
        </button>
        <button class="cancel-btn" (click)="cancelMultiSelect()">Cancel</button>
      </ng-container>
    </div>

    <div class="search">
      <input type="search" placeholder="Search" (input)="onSearch($event)">
      <i class='fas fa-search'></i>
    </div>
  </div>
  
  <div class="table">
    <table>
      <thead>
        <tr>
          <th *ngIf="multiSelectMode"><input type="checkbox" (change)="toggleSelectAll($event)" /></th>
          <th>S/N</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone Nos</th>
          <th>Gender</th>
          <th>Date of Birth</th>
          <th>Nationality</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users; let i = index" 
          (mousedown)="startPress($event, user)" 
          (mouseup)="cancelPress()" 
          (mouseleave)="cancelPress()"
          [class.selected-row]="user.selected">
          <td *ngIf="multiSelectMode">
            <input type="checkbox" [(ngModel)]="user.selected" (change)="updateSelectedUsers(user)">
          </td>
          <td>{{ i + 1 }}</td>
          <td>
            <img [src]="'https://localhost:7208' + user.picture" alt="User Picture" class="user-img" />
            {{ user.lastName }} {{ user.firstName }}
          </td>
          <td>{{ user.email }}</td>
          <td>{{ user.phone }}</td>
          <td>{{ user.gender }}</td>
          <td>{{ user.dateOfBirth | date }}</td>
          <td>{{ user.nationality }}</td>
          <td>{{ user.role.name }}</td>
          <td *ngIf="!multiSelectMode">
            <div class="action">
              <button class="edit-btn" (click)="openEditModal(user)" type="button">
                <i class="far fa-edit"></i>
              </button>
              <button class="delete-btn" (click)="deleteUser(user.id)" type="button">
                <i class="far fa-trash-alt"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

    <!-- Create User Modal -->
    <div class="modal" *ngIf="showCreateModal">
      <div class="modal-content">
        <span class="close" (click)="closeCreateModal()">&times;</span>
        <h2><i class="fas fa-user-plus"></i> Create User</h2>

        <form (ngSubmit)="createUser()" #userForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label>First Name</label>
              <input type="text" [(ngModel)]="newUser.firstName" name="firstName" required>
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <input type="text" [(ngModel)]="newUser.lastName" name="lastName" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="newUser.email" name="email" required>
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input type="text" [(ngModel)]="newUser.phone" name="phone">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Gender</label>
              <select id="gender" name="gender" [(ngModel)]="newUser.gender">
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="form-group">
              <label>Date of Birth</label>
              <input type="date" [(ngModel)]="newUser.dateOfBirth" name="dateOfBirth">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Nationality</label>
              <input type="text" [(ngModel)]="newUser.nationality" name="nationality">
            </div>
            <div class="form-group">
              <label>Role</label>
              <select [(ngModel)]="newUser.roleId" name="roleId" required>
                <option value="">Select Role</option>
                <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Profile Picture</label>
            <input type="file" (change)="onFileSelected($event)" (change)="onFileSelected($event)" name="picture" class="full-width">
          </div>

          <button type="submit" [disabled]="userForm.invalid">
            <i class="fas fa-user-plus"></i> Create User</button>
          </form>        
      </div>
    </div>
      
      <!-- Edit User Modal -->
       <div class="modal" *ngIf="showEditModal">
        <div class="modal-content">
          <span class="close" (click)="closeEditModal()">&times;</span>
          <h2><i class="fas fa-user-edit"></i> Edit User</h2>

          <form (ngSubmit)="updateUser()" #editForm="ngForm">
            <div class="form-row">
              <div class="form-group">
                <label>First Name</label>
                <input type="text" [(ngModel)]="editUser.firstName" name="firstName" required>
              </div>
              <div class="form-group">
                <label>Last Name</label>
                <input type="text" [(ngModel)]="editUser.lastName" name="lastName" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Email</label>
                <input type="email" [(ngModel)]="editUser.email" name="email" required>
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="text" [(ngModel)]="editUser.phone" name="phone">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Gender</label>
                <select id="gender" name="gender" [(ngModel)]="editUser.gender">
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" [(ngModel)]="editUser.dateOfBirth" name="dateOfBirth">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Nationality</label>
                <input type="text" [(ngModel)]="editUser.nationality" name="nationality">
              </div>
              <div class="form-group">
                <label>Role</label>
                <select [(ngModel)]="editUser.roleId" name="roleId" required>
                  <option value="">Select Role</option>
                  <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>Profile Picture</label>
              <input type="file" (change)="onEditFileSelected($event)" name="picture" class="full-width">
            </div>

            <button type="submit" [disabled]="editForm.invalid">
              <i class="fas fa-user-edit"></i> Update User
            </button>
          </form>
        </div>
      </div>
